<?php

namespace App\Livewire\Pages;

use App\Models\Answer;
use App\Models\QuizzLink;
use Livewire\Component;

class TestFor extends Component
{
    public array $answers = [];
    public bool $submitted = false;
    
    protected array $questions = [
        'Таңертеңгі ұйқыдан тұрғандағы сезіміңіз қандай?' => [
            'A) Шаршап тұрамын, қайта ұйықтағым келеді.',
            'B) Жаңа күнге дайынмын, белсендімін.',
            'C) Ешқандай ерекше сезім жоқ, күнделікті әдетім.'
        ],
        'Көңіл-күйіңіз түссе, не істейсіз?' => [
            'A) Мәселемен бетпе-бет келуге тырысамын.',
            'B) Достарыммен немесе жақындарыммен сөйлесемін.',
            'C) Уақытша жағдай деп қарап, елемеуге тырысамын.'
        ],
        'Өз өміріңіздегі маңызды шешімдерді қалай қабылдайсыз?' => [
            'A) Жақын адамдардың пікіріне сүйенемін.',
            'B) Барлық мүмкіндіктерді саралап, өз бетіммен шешім қабылдаймын.',
            'C) Кейде асығыс шешім қабылдаймын, кейде ұзақ ойланып жүремін.'
        ],
        'Жаңа ортаға қалай бейімделесіз?' => [
            'A) Бірден бейімделемін, адамдармен оңай тіл табысамын.',
            'B) Аздап уақыт қажет, бірақ соңында үйреніп кетемін.',
            'C) Бейімделу маған қиынға түседі.'
        ],
        'Бос уақытыңызды қалай өткізесіз?' => [
            'A) Спортпен шұғылданамын немесе табиғатқа шығамын.',
            'B) Достарыммен кездесемін немесе фильм көремін.',
            'C) Үйде қалып, кітап оқығанды немесе музыка тыңдағанды ұнатамын.'
        ],
        'Қиын жағдайлармен қалай күресесіз?' => [
            'A) Проблеманы шешудің нақты жоспарын құрып, әрекет етемін.',
            'B) Эмоцияларымды басқара алмай, қатты алаңдаймын.',
            'C) Уақыт өте бәрі шешіледі деп сенемін.'
        ],
        'Өзіңізді қалай сипаттайсыз?' => [
            'A) Оптимист және белсендімін.',
            'B) Тыныш және байсалды адаммын.',
            'C) Сезімтал және эмоцияларға тез берілетін адаммын.'
        ]
    ];

    public function submit()
    {

        $result = "";


        $counts = ['A' => 0, 'B' => 0, 'C' => 0];

        foreach ($this->answers as $answer) {
            $firstLetter = substr($answer, 0, 1);

            if (isset($counts[$firstLetter])) {
                $counts[$firstLetter]++;
            }

        }

        if ($counts['A'] > $counts['B'] && $counts['A'] > $counts['C']) {
            $result = "Сіз белсенді, мақсатқа ұмтылғыш, өмірге деген көзқарасы оң адамсыз. Қиындықтардан қорықпайсыз, өзіңізге сенімдісіз және өмірден барынша ләззат алуға тырысасыз.";
        } elseif ($counts['B'] > $counts['A'] && $counts['B'] > $counts['C']) {
            $result = "Сіз сабырлы, салмақты және жақсы ойластырылған шешімдер қабылдайтын адамсыз. Достарыңыз бен отбасыңызға маңызды тірек бола аласыз.";
        } else {
            $result = "Сіз сезімтал және эмоционалды адамсыз. Өзіңізді түсінуге уақыт бөлгенді ұнатасыз. Кейде өзіңізге сенімділікті арттыруға күш салу қажет.";
        }   

        if (auth()->check()) {
            $answer = Answer::query()->create([
                'user_id' => auth()->user()->id,
                'answer' => $result
            ]);
        }
        
        $this->submitted = true;
    }

    public function render()
    {
        return view('livewire.pages.test-for', [
            'questions' => $this->questions,
            'quizzes' => QuizzLink::all()
        ]);
    }
}
